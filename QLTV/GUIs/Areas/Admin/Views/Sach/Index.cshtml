

@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_Layout2.cshtml";
}

<h2>Index</h2>

<p>
    @Html.ActionLink("Create New", "Create")
    <br />
    <input type="text" id="tensach" placeholder="Ten sach" />


    @Html.DropDownList("NhaXuatBan", new SelectList(ViewBag.listnxb, "ID", "TenNXB"), new { @class = "form-control" })
    @Html.DropDownList("PhanLoai", new SelectList(ViewBag.listphanloai, "ID", "TenPhanLoai"), new { @class = "form-control" })
    @Html.DropDownList("Pagesize", new SelectList(ViewBag.Pagesize, "ID", "ID"), new { @class = "form-control" })


</p>
<table class="table">
    <tr>
        <th>
            STT
        </th>
        <th>
            Ten Sach
        </th>
        <th>
            Phan Loai
        </th>
        <th>
            Ten nha xuat ban
        </th>
        <th>
            Gia Tien
        </th>
        <th>
            Anh Bia
        </th>

        <th>Chinh Sua</th>
        <th>Tac gia</th>
        <th> Xoa</th>
        <th>Them dau sach</th>
    </tr>
    <tbody id="tbData"></tbody>
    <tfoot>
        <tr>
            <th colspan="100" id="pages">

            </th>
        </tr>
    </tfoot>
</table>

 
<div class="modal fade" id="themtacgia" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Đang thêm tác giả cho đầu sách:.....</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- bảng chứa tác giả đã nhập -->
                <select id="Tacgiaid">
                     
                </select>  
                <button id="btnthemtacgia">Thêm tác giả</button>
                <input type="hidden" id="sachid" />
                <table id="themtacgiasach">
                    <tr>
                        <td>
                            <input type="checkbox" />
                        </td>
                        <td>Tên tác giả</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="checkbox" />
                        </td>
                        <td>Tên tác giả</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="checkbox" />
                        </td>
                        <td>Tên tác giả</td>
                    </tr>
                    <tr>
                        <td>
                            <input type="checkbox" />
                        </td>
                        <td>Tên tác giả</td>
                    </tr>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>



@section scripts{
    <script>


        var sach = {
            init: function () {
                sach.search(1);
                $("#tensach").change(function () {
                    sach.search(1);
                });
                $("#NhaXuatBan").change(function () {
                    sach.search(1);
                });
                $("#PhanLoai").change(function () {
                    sach.search(1);
                });
                $("#Pagesize").change(function () {
                    sach.search(1);
                });
                $("#btnthemtacgia").click(function () {
                    var idsach = $("#sachid").val();
                    var idtacgia = $("#Tacgiaid").val();
                    var form = new FormData();
                    form.append("idsach", idsach);
                    form.append("idtacgia", idtacgia);
                    $.ajax({
                        type: 'POST',
                        dataType: 'Json',
                        contentType: false,
                        processData: false,
                        data: form,
                        url: '/Admin/Sach/Themtacgiasach/',
                        success: function (res) {
                            alert(res.mess);
                            sach.loadtacgia(idsach);
                        }
                    })
                });

                $('#themtacgia').on('show.bs.modal', function (event) {
                    var button = $(event.relatedTarget) // Button that triggered the modal
                    var masach = button.data('whatever') // Mã sách
                    //Gọi tác đã thêm và tác giả chưa thêm
                    sach.loadtacgia(masach);
                  //  var modal = $(this)
                   // modal.find('.modal-title').text('New message to ' + masach)
                   // modal.find('.modal-body input').val(recipient)
                })
            },
            loadtacgia: function (id) {
                $("#sachid").val(id);

                $.ajax({
                    type: 'get',
                    dataType: 'JSON',
                    url: '/Admin/Sach/Laydanhsachtacgia/' + id,
                    success: function (res) {
                        $("#themtacgiasach").html(res.data);
                        $("#Tacgiaid").html(res.tacgia);
                    }
                });
            }, 
            search: function (index) {
                var tensach = $("#tensach").val();
                var phanloai = $("#PhanLoai").val();
                var nxb = $("#NhaXuatBan").val();
                var size = $("#Pagesize").val();
                var form = new FormData()
                form.append("tensach", tensach);
                form.append("phanloai", phanloai);
                form.append("nhaxb", nxb);
                form.append("index", index);
                form.append("size", size);
                $.ajax({
                    type: 'POST',
                    dataType: 'Json',
                    contentType: false,
                    processData: false,
                    data: form,
                    url: '/Admin/Sach/Search/',
                    success: function (res) {
                        $("#tbData").html(res.data);
                        $("#pages").html(res.page);

                    },
                });
            },
            themtacgia: function (id) {

            }
        }
        sach.init();
        function goto(i) {
            sach.search(i);
        }
    </script>
}